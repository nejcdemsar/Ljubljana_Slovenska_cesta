<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive Street Facade Viewer</title>
<style>
body { margin:0; overflow:hidden; font-family:sans-serif; }
#container { width:100%; height:100%; }
#loading {
  position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
  color:white; background:rgba(0,0,0,0.8); padding:20px; border-radius:12px;
  text-align:center; z-index:10;
}
#progress-bar { width:200px; height:15px; background:#333; border-radius:8px; margin-top:10px; overflow:hidden;}
#progress { width:0%; height:100%; background:#4facfe; border-radius:8px;}
#controls-ui {
  position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.6);
  color:white; padding:15px; border-radius:10px; z-index:10;
  max-width:200px; font-size:0.9em;
}
#controls-ui h3 { margin-top:0; color:#4facfe; }
</style>
</head>
<body>
<div id="container"></div>
<div id="loading">
  Loading street...
  <div id="progress-bar"><div id="progress"></div></div>
</div>
<div id="controls-ui">
  <h3>Controls</h3>
  <p><strong>W</strong> : Move forward</p>
  <p><strong>S</strong> : Move backward</p>
  <p><strong>A</strong> : Move left</p>
  <p><strong>D</strong> : Move right</p>
  <p><strong>Shift</strong> : Hold to move faster</p>
  <p><strong>R</strong> : Reset position</p>
  <p>Click anywhere to lock mouse and start exploring</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/PointerLockControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>

<script>
let camera, scene, renderer, controls;
let loadedParts = 0, totalParts = 9;
const move = {forward:false, backward:false, left:false, right:false, boost:false};

// Starting/reset position
const startPosition = new THREE.Vector3(0, 1.6, 0); // 5 steps forward (Z=0 instead of Z=5)

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x88ccff);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.copy(startPosition);

  const ambient = new THREE.AmbientLight(0xffffff, 1.0);
  scene.add(ambient);

  const directional = new THREE.DirectionalLight(0xffffff, 0.8);
  directional.position.set(1,1,0.5).normalize();
  scene.add(directional);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.getElementById('container').appendChild(renderer.domElement);

  controls = new THREE.PointerLockControls(camera, document.body);
  document.body.addEventListener('click', () => controls.lock());
  scene.add(controls.getObject());

  // Load street parts
  const loader = new THREE.GLTFLoader();
  for(let i=1;i<=totalParts;i++){
    loader.load(`street_part${i}.glb`,
      gltf => {
        // Reduce shininess of all materials
        gltf.scene.traverse(obj=>{
          if(obj.isMesh && obj.material){
            if('metalness' in obj.material) obj.material.metalness = 0.1;
            if('roughness' in obj.material) obj.material.roughness = 0.9;
          }
        });

        scene.add(gltf.scene);
        loadedParts++;
        document.getElementById('progress').style.width = (loadedParts/totalParts*100)+'%';
        if(loadedParts===totalParts) document.getElementById('loading').style.display='none';
      },
      undefined,
      err => { console.error(err); loadedParts++; }
    );
  }

  // Add ground plane (huge, white)
  const groundGeo = new THREE.PlaneGeometry(1000, 1000);
  const groundMat = new THREE.MeshStandardMaterial({color:0xffffff, roughness:1, metalness:0});
  const ground = new THREE.Mesh(groundGeo, groundMat);
  ground.rotation.x = -Math.PI/2;
  ground.position.y = 0;
  ground.receiveShadow = true;
  scene.add(ground);

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  // Movement keys
  document.addEventListener('keydown', e => {
    switch(e.code){
      case 'KeyW': move.forward=true; break;
      case 'KeyS': move.backward=true; break;
      case 'KeyA': move.left=true; break;
      case 'KeyD': move.right=true; break;
      case 'ShiftLeft': move.boost=true; break;
      case 'KeyR': controls.getObject().position.copy(startPosition); break;
    }
  });
  document.addEventListener('keyup', e => {
    switch(e.code){
      case 'KeyW': move.forward=false; break;
      case 'KeyS': move.backward=false; break;
      case 'KeyA': move.left=false; break;
      case 'KeyD': move.right=false; break;
      case 'ShiftLeft': move.boost=false; break;
    }
  });
}

function animate() {
  requestAnimationFrame(animate);

  if(controls.isLocked){
    let speed = 0.1;
    if(move.boost) speed *= 2;

    if(move.forward) controls.moveForward(speed);
    if(move.backward) controls.moveForward(-speed);
    if(move.left) controls.moveRight(-speed);
    if(move.right) controls.moveRight(speed);
  }

  renderer.render(scene, camera);
}
</script>
</body>
</html>
